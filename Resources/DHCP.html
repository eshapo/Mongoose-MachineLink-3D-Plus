<!doctype html>
<html class="no-js" lang="en">
<!--
  Common include to check the session is current and if not redirect to the
  login page, then after logging in redirect back to the referring page.
  Note a redirect on a non-root user can be effected by defining the
  pre-processor symbol "CHECK_ROOT_USER" before including this file.
-->
<!-- <%
// Check the session, if timed out redirect, and pass the referring page as
// an argument. This allows index.html to redirect back to the referring page.
useSession();
if (
    request["SESSION_ID"] != session["sessionid"]) {
  redirect('/index.html?src=' + request["SCRIPT_NAME"]);
  exit(403);
}
%> -->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>DHCP</title>

<script>
(function() {
 var html = document.documentElement;
 html.className = html.className.replace('no-js','') + ' js';
})();
var modules = [];
</script>
<!--[if lt IE 9]>
<script src="vdf-lib/js/lib/selectivizr.min.js"></script>
<script src="js/libs/html5-shiv.min.js"></script>
<noscript>
 <link rel="stylesheet" href="vdf-lib/css/ie/ie.min.css">
</noscript>
<![endif]-->
<!--[if IE 6]>
<link rel="stylesheet" href="css/ie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" href="css/ie7.css">
<![endif]-->
<!--[if lte IE 7]>
<link rel="stylesheet" href="css/ie6-ie7.css">
<![endif]-->
<link rel="stylesheet" href="vdf-lib/css/main.min.css?2.0.18.9">
<link rel="stylesheet" href="css/style.css?2.0.18.9">
<link rel="stylesheet" href="css/jquery-ui.css">
<link rel="shortcun icon" type="image/x-icon" href="favicon.ico">
</head>
<!--[if IE 6]>
 <body class="ie ie6">
<![endif]-->
<!--[if IE 7]>
 <body class="ie ie7">
<![endif]-->
<!--[if IE 8]>
 <body class="ie ie8">
<![endif]-->
<!--[if IE 9]>
 <body class="ie ie9">
<![endif]-->
<!--[if gt IE 9]>
 <body>
<![endif]-->
<!--[if !IE]><!-->
<body>
<!--<![endif]-->
<script src="js/jquery.min.js?2.0.18.9" type="text/javascript"></script>
<script src="js/jquery.validate.min.js?2.0.18.9" type="text/javascript" charset="utf-8"></script>
<script src="js/script.js?2.0.18.9"></script>
<script src="vdf-lib/js/main.min.js?2.0.18.9"></script>
<!--**********************************************************-->
<script type="text/javascript" src="lang/b28n.js?2.0.18.9"></script>
<script language="JavaScript" src="js/jquery.blockUI.js"></script>
<script src="js/jquery-ui.js"></script>
<script src="js/jquery.ui.touch-punch.min.js"></script>
<script type="text/javascript" src="util.js?2.0.18.9"></script>
<script language='javascript'>
var fn="DHCP.html".replace(".html", "");
if(fn=="" || fn=="/") {
 fn="index";
}
Butterlate.setTextDomain(fn.replace("/", ""));
$.blockUI.defaults.css.padding="20px 0 20px 0";
var roam_simcard="0";
if(!is_touch_device()) {$("head").append("<style type='text/css'>.footer {position:fixed;}</style>");}
</script>
<script language="JavaScript" src="cgi-bin/dhcp.cgi"></script>
<script language="JavaScript">
/*****************net_util.js************************/
function WinExpIP(field,event) {
 if( field.value=="") {
  if($(field).hasClass("required")) {
   $(field).valid();
  }
 }
 else {
  if(!isValidIpEntry(field,event))
   validate_alert( "", "You must enter a value between 0 and 255. Please try again.");
  else
   clear_alert();
 }
}
function WinExpIP_1(field,event) {
 if( field.value=="") {
  if($(field).hasClass("required")) {
   $(field).valid();
  }
 }
 else {
  switch(isValidIpEntry_1(field,event)) {
  case -1:
   validate_alert( "", "You must enter a value between 1 and 223. Please try again.");
  break;
  case -2:
   validate_alert( "", "An IP address can't start with 127. Please try another value between 1 and 223.");
  break;
  default:
   clear_alert();
  break;
  }
 }
}
function WinExpIP_0(field,event) {
 if( field.value=="") {
  if($(field).hasClass("required")) {
   $(field).valid();
  }
 }
 else {
  if(isNValidIP(field.value))
   validate_alert( "", "Please specify a value between 0 and 255.");
  else
   clear_alert();
 }
}
function WinExpIP_127(field,event) {
 if( field.value=="") {
  if($(field).hasClass("required")) {
   $(field).valid();
  }
 }
 else {
  if(isNValidIP(field.value) || field.value <1 || field.value >223)
   validate_alert( "", "dhcp warningMsg1");
  else
   clear_alert();
 }
}
function hostMin(ip, mask) {
 var host_array=new Array();
 ip_array = ip.split('.');
 mask_array = mask.split('.');
 for (i = 0; i < 4; i++) {
  host_array[i] = parseInt(ip_array[i])&parseInt(mask_array[i]);
 }
 host_array[3]++;
 return host_array.join(".");
}
function hostMax(ip, mask) {
 var host_array=new Array();
 var wildcard_array=new Array();
 ip_array = ip.split('.');
 mask_array = mask.split('.');
 for (i = 0; i < 4; i++) {
  wildcard_array[i]=~parseInt(mask_array[i])&255;
  host_array[i] = parseInt(ip_array[i])&parseInt(mask_array[i])|wildcard_array[i];
 }
 host_array[3]--;
 return host_array.join(".");
}
function checkIPrange(ipMin, ipMax, myip) {
var fromArr = ipMin.split(".");
var toArr = ipMax.split(".");
var myipArr = myip.split(".");
var fromip=0; toip=0; myip=0;
 for(i=0;i<4;i++) {
  fromip=fromip*1000+parseInt(fromArr[i]);
  toip=toip*1000+parseInt(toArr[i]);
  myip=myip*1000+parseInt(myipArr[i]);
 }
 if(myip<fromip || myip>toip) {
  return false;
 }
 return true;
}
function isWithinHostIpRange(ip, mask, myip) {
 return checkIPrange(hostMin(ip, mask), hostMax(ip, mask), myip);
}
function checkIpAddr(field, ismask, msg) {
 if (field.value == "") {
  if (ismask) {
   validate_alert( "", typeof(msg)!="undefined"?msg+"You must enter a netmask. Please try again.":"You must enter a netmask. Please try again.");//The netmask is empty.
  }
  else {
   validate_alert( "", typeof(msg)!="undefined"?msg+"The IP address is empty. Please try again.":"The IP address is empty. Please try again.");//IP address is empty.
  }
  field.value = field.defaultValue;
  field.focus();
  return false;
 }
 if (isAllNum(field.value) == 0) {
  validate_alert( "", typeof(msg)!="undefined"?msg+"You must enter a number between [1-9]. Please try again.":"You must enter a number between [1-9]. Please try again.");//'It should be a [0-9] number.'
  field.value = field.defaultValue;
  field.focus();
  return false;
 }
 if (ismask) {
  if ((!checkRange(field.value, 1, 0, 256)) ||
   (!checkRange(field.value, 2, 0, 256)) ||
   (!checkRange(field.value, 3, 0, 256)) ||
   (!checkRange(field.value, 4, 0, 256)))
  {
   validate_alert( "", typeof(msg)!="undefined"?msg+"You have entered the netmask incorrectly. Please try again.":"You have entered the netmask incorrectly. Please try again.");//'The netmask has wrong format.'
   field.value = field.defaultValue;
   field.focus();
   return false;
  }
 }
 else {
  if ((!checkRange(field.value, 1, 0, 255)) ||
   (!checkRange(field.value, 2, 0, 255)) ||
   (!checkRange(field.value, 3, 0, 255)) ||
   (!checkRange(field.value, 4, 1, 254)))
  {
   if (ismask) {
    validate_alert( "", typeof(msg)!="undefined"?msg+"You have entered the netmask incorrectly. Please try again.":"You have entered the netmask incorrectly. Please try again.");//'The netmask has wrong format.'
   }
   else {
    validate_alert( "", typeof(msg)!="undefined"?msg+"You have entered the IP address incorrectly. Please try again.":"You have entered the IP address incorrectly. Please try again.");//'IP adress format error.'
   }
   field.value = field.defaultValue;
   field.focus();
   return false;
  }
 }
 clear_alert();
 return true;
}
function parse_ip_into_fields(ipaddr, name) {
 var i;
 var ip_array;
 //var ipaddr="192.168.1.1";
 ip_array=ipaddr.split(".");
 if(ip_array.length != 4 ) {ip_array[0]=''; ip_array[1]='';ip_array[2]=''; ip_array[3]='';}
 for(i=0;i<4;i++) {
  $("input[name="+name+(i+1)+"]").val(ip_array[i]||"");
 }
}
function parse_ip_from_fields(documentItem) {
 var ip_array=new Array();
 var val;
 var j=0;
 for(var i=0;i<4;i++) {
  val=$("input[name="+documentItem+(i+1)+"]").val();
  if(val!="") {
   ip_array[j++]=val;
  }
 /*	else {
			return "";
		}*/
 }
 return ip_array.join(".");
}
function ValidSubnetMask(n, t){
 NumfieldEntry(t);
 if(isValidSubnetMask(parse_ip_from_fields(n))<0) {
  for(i=0;i<4;i++) {
   $("input[name="+n+(i+1)+"]").removeClass("success-text").addClass("failure-text");
  }
 }
 else {
  for(i=0;i<4;i++) {
   $("input[name="+n+(i+1)+"]").removeClass("failure-text").addClass("success-text");
  }
 }
}
function htmlGenIpBlocks(name_in) {
 h="<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"1' id='"+name_in+"1' onkeyup='NumfieldEntry(this);WinExpIP_1(this,event)'></div>	<label for='"+name_in+"1' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"2' id='"+name_in+"2' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"2' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"3' id='"+name_in+"3' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"3' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"4' id='"+name_in+"4' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"4' class='input-connect-dot'></label>";
 printf(h);
}
function htmlGenIpBlocks0(name_in) {
 h="<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"1' id='"+name_in+"1' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"1' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"2' id='"+name_in+"2' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"2' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"3' id='"+name_in+"3' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"3' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"4' id='"+name_in+"4' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"4' class='input-connect-dot'></label>";
 printf(h);
}
function htmlGenIpBlocks127(name_in) {
 h="<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"1' id='"+name_in+"1' onkeyup='NumfieldEntry(this);WinExpIP_127(this,event)'></div>	<label for='"+name_in+"1' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"2' id='"+name_in+"2' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"2' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"3' id='"+name_in+"3' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"3' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"4' id='"+name_in+"4' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"4' class='input-connect-dot'></label>";
 printf(h);
}
function htmlGenMaskBlocks(name_in) {
 printf("<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='%s1' id='%s1' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label for='"+name_in+"1' class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='%s2' id='%s2' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label for='"+name_in+"2' class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='%s3' id='%s3' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label for='"+name_in+"3' class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='%s4' id='%s4' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label for='"+name_in+"4' class='input-connect-dot'></label>");
}
function htmlGenIpBlocksWithoutRequired(name_in) {
 h="<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"1' id='"+name_in+"1' onkeyup='NumfieldEntry(this);WinExpIP_1(this,event)'></div>	<label for='"+name_in+"1' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"2' id='"+name_in+"2' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"2' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"3' id='"+name_in+"3' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"3' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"4' id='"+name_in+"4' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"4' class='input-connect-dot'></label>";
 printf(h);
}
function htmlGenIpBlocksWithoutRequired0(name_in) {
 h="<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"1' id='"+name_in+"1' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"1' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"2' id='"+name_in+"2' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"2' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"3' id='"+name_in+"3' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"3' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"4' id='"+name_in+"4' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"4' class='input-connect-dot'></label>";
 printf(h);
}
function htmlGenMaskBlocksWithoutRequired(name_in) {
 printf("<div class='field'><input type='text' class='ip-adress' maxLength='3' name='%s1' id='%s1' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='ip-adress' maxLength='3' name='%s2' id='%s2' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='ip-adress' maxLength='3' name='%s3' id='%s3' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='ip-adress' maxLength='3' name='%s4' id='%s4' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label class='input-connect-dot'></label>");
}
/******************End of net_util.js***********************/
var f = document.form;
function submitF1() {
var f=document.form;
/********* vdf validator**********/
 if(!$("#form").valid()) {
  return;
 }
 // if the dhcp is enabled then validate all the DHCP values...
 startAddr=parse_ip_from_fields("DHCPStart");
 endAddr=parse_ip_from_fields("DHCPEnd");
 if (f.DHCPConf[0].checked == true) {
  var myip="192.168.1.1";
  var mymask="255.255.255.0";
  if (!checkIPrange(startAddr, endAddr, endAddr)) {
   validate_alert("", "invalidDHCPange");
   return;
  }
  if (!isWithinHostIpRange(myip, mymask, startAddr)) {
   validate_alert("", "The DHCP start address must be inside the LAN IP subnet range. Please try again.");
   return;
  }
  if (!isWithinHostIpRange(myip, mymask, endAddr)) {
   validate_alert("", "The DHCP end address must be inside the LAN IP subnet range. Please try again.");
   return;
  }
 }
 f.DHCPrange.value = startAddr + "," + endAddr;
 f.DNS1.value=parse_ip_from_fields("DNSAddress1");
 f.DNS2.value=parse_ip_from_fields("DNSAddress2");
 f.WINSIP1.value=parse_ip_from_fields("WINSIP1");
 f.WINSIP2.value=parse_ip_from_fields("WINSIP2");
 f.NTPserver.value=parse_ip_from_fields("NTPserver");
 ungreyOutAllDHCPFields();
 f.DHCPServerAddr.value=parse_ip_from_fields("DHCPServerAddr");
 f.submit();
}
function submitF3() {
var f3=document.form3;
 for(var i=0; i<=f3.maxReservation.value; i++) {
  if(!( document.getElementById('macid'+i) )) {
   continue;
  }
  else {
   if(!isValidMacAddress(document.getElementById('macid'+i).value))//&&(document.getElementById('name'+i).value)=="")
   {
    validate_alert("", "Invalid MAC address. Please try again."+" "+"Please specify a HEX value (0-9, A-F)."+" "+"For example 12:34:56:AB:CD:EF");
    return;
   }
  }
 }
 k=0;
 f3.rdbCmd.value="";
 for( i=0; i<f3.maxReservation.value; i++) {
  if(!( document.getElementById('ipid'+i) )) {
   continue;
  }
  else {
   document.getElementById('ipid'+i).value = document.getElementById('ip1'+i).value+"."+document.getElementById('ip2'+i).value+"."+document.getElementById('ip3'+i).value+"."+document.getElementById('ip4'+i).value;
   for(var j="1"; j<i; j++ ) {
    // alert(document.getElementById('ipid'+j).value);
    if(!( document.getElementById('ipid'+j) )) {
     continue;
    }
    if( ( (document.getElementById('ipid'+j).value) == (document.getElementById('ipid'+i).value) ) ) {
     validate_alert("", "There's a conflict with the IP address "+document.getElementById('ipid'+j).value+", "+"Please choose a different IP and try again");
     return;
    }
   }
  }
  if( k>0 ) {
   f3.rdbCmd.value+='&';
  }
  var enable = document.getElementById('enabled'+i+'-0').checked==true?"enabled":"disabled";
  f3.rdbCmd.value += "service.dhcp.static."+k+"="+document.getElementById('name'+i).value+","+document.getElementById('macid'+i).value+","+document.getElementById('ipid'+i).value+","+enable;
  k++;
 }
 if(k==0) {
  f3.rdbCmd.value = "service.dhcp.static.0";
 }
 else {
  f3.rdbCmd.value += "&service.dhcp.static."+k+"=";
 }
 f3.rdbCmd.value += "&service.dhcp.static.trigger=1";
 f3.submit();
}
// for when submit form
function ungreyOutAllDHCPFields() {
var f=document.form;
 f.DHCPStart1.disabled = false;
 f.DHCPStart2.disabled = false;
 f.DHCPStart3.disabled = false;
 f.DHCPStart4.disabled = false;
 f.DHCPEnd1.disabled = false;
 f.DHCPEnd2.disabled = false;
 f.DHCPEnd3.disabled = false;
 f.DHCPEnd4.disabled = false;
 f.DHCPLease.disabled = false;
 f.DDNsuffix.disabled = false;
 f.DNSAddress11.disabled = false;
 f.DNSAddress12.disabled = false;
 f.DNSAddress13.disabled = false;
 f.DNSAddress14.disabled = false;
 f.DNSAddress21.disabled = false;
 f.DNSAddress22.disabled = false;
 f.DNSAddress23.disabled = false;
 f.DNSAddress24.disabled = false;
 f.WINSIP11.disabled = false;
 f.WINSIP12.disabled = false;
 f.WINSIP13.disabled = false;
 f.WINSIP14.disabled = false;
 f.WINSIP21.disabled = false;
 f.WINSIP22.disabled = false;
 f.WINSIP23.disabled = false;
 f.WINSIP24.disabled = false;
 f.DHCPServerAddr1.disabled = false;
 f.DHCPServerAddr2.disabled = false;
 f.DHCPServerAddr3.disabled = false;
 f.DHCPServerAddr4.disabled = false;
}
function greyOutDHCPFields() {
 document.form.DHCPenable.value='0';
 $("#box_dhcp").css("display", "none");
 $(".box_reservation").css("display", "none");
 return;
}
// this is when disabling DHCP
function ungreyOutDHCPFields() {
 document.form.DHCPenable.value='1';
 $("#box_dhcp").css("display", "");
 $(".box_reservation").css("display", "");
 return;
}
// this is when enabling DHCP Relay
function greyOutRelayFields() {
 document.form.DHCPrelay.value='0'
 $("#box_dhcp_relay").css("display", "none");
 $(".box_dhcp_conf").css("display", "");
 if (document.form.DHCPenable.value=='0') {
  greyOutDHCPFields();
 }
 else {
  ungreyOutDHCPFields();
 }
 return;
}
function ungreyOutRelayFields() {
 document.form.DHCPrelay.value='1';
 $("#box_dhcp_relay").css("display", "");
 $(".box_dhcp_conf").css("display", "none");
 return;
}
function checkDHCPConf() { //onload
 if (document.form.DHCPrelay.value == '0') {
  greyOutRelayFields();
 }
 else {
  ungreyOutRelayFields();
 }
}
function cloneLeasesData( hostname, mac, ip ) {
 if( document.getElementById( "reservationdiv1" ).style['display']=='none') {
  hideItem('reservationdiv', 1);
 }
 for( i=0; i<document.form3.maxReservation.value; i++) {
  if(!( document.getElementById('ipid'+i) )) {
   continue;
  }
  else {
   var myip=$("#ip1"+i).val()+"."+$("#ip2"+i).val()+"."+$("#ip3"+i).val()+"."+$("#ip4"+i).val();
   if(hostname==$("#name"+i).val() || mac==$("#mac"+i).val() || ip==reservationdata[i].ip) {
    blockUI_alert("This address already exists in the reservation list. Please choose another address.");
    return;
   }
  }
 }
 addElement( hostname, mac, ip, 1);
}
function displayReservationData() {
	var reservationdata=[ ]; var leasesdata=[ { "ends":"1424237027", "mac":"00:60:6e:42:41:14", "ip":"192.168.1.124", "hostname":"NTCLT0110" } ]; 
 if(reservationdata.length==0) {
  $("#ReservationDiv-title").css("display","none");
 }
 else {
  for(i=0; i<reservationdata.length; i++) {
   addElement( reservationdata[i].computerName, reservationdata[i].mac, reservationdata[i].ip, reservationdata[i].enable=='enabled'? 1:0 );
  }
 }
}
function addElement(name, mac, ip, enabled) {
var num = $("#maxReservation").val();
var divIdName = 'myDiv'+num;
var radio0Enabled = (enabled=='1')?"checked=\"checked\"":"";
var radio1Enabled = (enabled!='1')?"checked=\"checked\"":"";
var ray = new Array();
 ray = ip.split(".");
 if(ray.length != 4 ){ray[0]='0';ray[1]='0';ray[2]='0';ray[3]='0';}
 $("#ReservationDiv-title").css("display","");
 h='<table class="no-border" id="'+divIdName+'" style="margin-bottom:0"><tr>		<td>			<div class="form-row">				<div class="field">					<input type="text" class="table-input" id="name'+num+'" name="listname'+num+'" size=12 value="'+name+'">				</div>			</div>		</td>		<td>			<div class="form-row">				<div class="field">					<input type="text" class="table-input" maxlength="17" id="macid'+num+'" name="mac'+num+'" value="'+mac+'">				</div>			</div>		</td>		<td>			<div class="form-row">				<div class="field">					<input class="ip-adress" maxLength=3 name=p1'+num+' id="ip1'+num+'" value='+ray[0]+' onkeyup="javascript:WinExpIP_1(this,event)">				</div>				<span class="input-connect-dot">.</span>				<div class="field">					<input class="ip-adress" maxLength=3 name=p2'+num+' id="ip2'+num+'" value='+ray[1]+' onkeyup="javascript:WinExpIP(this,event)">				</div>				<span class="input-connect-dot">.</span>				<div class="field">					<input class="ip-adress" maxLength=3 name=p3'+num+' id="ip3'+num+'" value='+ray[2]+' onkeyup="javascript:WinExpIP(this,event)">				</div>				<span class="input-connect-dot">.</span>				<div class="field">					<input class="ip-adress" maxLength=3 name=p4'+num+' id="ip4'+num+'" value='+ray[3]+' onkeyup="javascript:WinExpIP(this,event)">				</div>				<input type=hidden name=ip'+num+' id="ipid'+num+'">			</div>		</td>		<td>			<div class="form-row no-bg-form">				<div class="field">					<div class="location-settings">						<div class="radio-switch">							<input type="radio" class="access" id="enabled'+num+'-0" name="enable'+num+'" '+radio0Enabled+'>							<label for="enabled'+num+'-0" class="on">'+"I"+'</label>							<input type="radio" class="access" id="enabled'+num+'-1" name="enable'+num+'" '+radio1Enabled+'>							<label for="enabled'+num+'-1" class="off">'+"0"+'</label>						</div>					</div>				</div>			</div>		</td>		<td class="last">			<button type=button onClick="removeThis('+"'"+divIdName+"'"+')" class="secondary sml" style="padding:0;border:0;">			<i class="icon close"></i></button>		</td>	</tr></table>';
 $("#ReservationDiv").append(h);
 $.get("vdf-lib/js/lib/selectivizr.min.js");
 document.form3.maxReservation.value++;
}
function removeThis(dId) {
 $("#ReservationDiv").children("#"+dId).remove();
}
function setall() {
var f = document.form;
var f3 = document.form3;
var ray = new Array();
var reservationdata=[ ]; var leasesdata=[ { "ends":"1424237027", "mac":"00:60:6e:42:41:14", "ip":"192.168.1.124", "hostname":"NTCLT0110" } ]; 
 if(f.DHCPenable.value=='1') {
  $("#DHCPConf-0").attr("checked", "checked");
 }
 else {
  $("#DHCPConf-1").attr("checked", "checked");
  $("#box_dhcp").css("display", "none");
 }
 if(f.DHCPrange.value=="0.0.0.0"){f.DHCPrange.value="";}
 parse_ip_into_fields(f.DHCPrange.value.split(",")[0], "DHCPStart");
 parse_ip_into_fields(f.DHCPrange.value.split(",")[1], "DHCPEnd");
 parse_ip_into_fields(f.DNS1.value, "DNSAddress1");
 parse_ip_into_fields(f.DNS2.value, "DNSAddress2");
 parse_ip_into_fields(f.WINSIP1.value, "WINSIP1");
 parse_ip_into_fields(f.WINSIP2.value, "WINSIP2");
 parse_ip_into_fields(f.DHCPServerAddr.value, "DHCPServerAddr");
 parse_ip_into_fields(f.NTPserver.value, "NTPserver");
 if(f.DHCPrelay.value=='1') {
  $("#DHCPRelayConf-0").attr("checked", "checked");
 }
 else {
  $("#DHCPRelayConf-1").attr("checked", "checked");
  $("#box_dhcp_relay").css("display", "none");
 }
 f3.maxReservation.value = reservationdata.length;
}
var ajaxerror=0;
function displayLeasesData(ld) {
 ajaxerror=0;
 eval(ld);
 var ht="";
 for(var i=0; i<leasesdata.length; i++ ) {
  ht+="<tr align=left><td>"+leasesdata[i].hostname+"</td><td>"+leasesdata[i].mac+"</td><td>"+leasesdata[i].ip+"</td><td>"+new Date((leasesdata[i].ends)*1000).toLocaleString()+"</td><td class='last'>";
  ht+="<button type='button' class='secondary sml' onClick=\"cloneLeasesData('"+leasesdata[i].hostname+"','"+leasesdata[i].mac+"','"+leasesdata[i].ip+"')\"><i class='icon clone'></i>"+"Clone"+"</button></td></tr>";
 }
 $("#lease_data").html(ht);
}
$(document).ready(function() {
var IPForward="value of rdb service.bridge.3GIPForward here";
 if(IPForward == "1") {//alert();
  greyOutDHCPFields();
  $("#DHCPConf-0").attr("checked", "checked");
  blockUI_alert("The MachineLink 3G is currently in transparent bridge mode so you can't configure DHCP. Please disable transparent bridge mode if you want to configure the DHCP server settings.");
  window.location="/LAN.html?ipsetup";
 }
 displayReservationData();
 //alert();
 setall();
 checkDHCPConf();
 var startPoll = function() {alert();
  if( ++ajaxerror<=5)
   $.get('/cgi-bin/dhcp.cgi', displayLeasesData);
  else
   location.reload();
 }
 $.get('/cgi-bin/dhcp.cgi', displayLeasesData);
 //setInterval(startPoll, 3000);
});
</script>
<!-- <%
if (request['REQUEST_METHOD'] == "POST") {
 if(request['QUERY_STRING']=='form1') {
  tempval = form['DHCPrange'];
  retval = set_single( 'service.dhcp.range.0='+tempval, '-p' );
  tempval = form['DHCPenable'];
  retval = set_single( 'service.dhcp.enable='+tempval, '-p' );
  tempval = form['DHCPLease'];
  retval = set_single( 'service.dhcp.lease.0='+tempval, '-p' );
  tempval = form['DDNsuffix'];
  retval = set_single( 'service.dhcp.suffix.0='+tempval, '-p' );
  tempval = form['DNS1'];
  retval = set_single( 'service.dhcp.dns1.0='+tempval, '-p' );
  tempval = form['DNS2'];
  retval = set_single( 'service.dhcp.dns2.0='+tempval, '-p' );
  tempval = form['WINSIP1'];
  retval = set_single( 'service.dhcp.win1.0='+tempval, '-p' );
  tempval = form['WINSIP2'];
  retval = set_single( 'service.dhcp.win2.0='+tempval, '-p' );
  tempval = form['NTPserver'];
  retval = set_single( 'service.dhcp.ntp_server.0='+tempval, '-p' );
  tempval = form['TFTPserver'];
  retval = set_single( 'service.dhcp.tftp_server.0='+tempval, '-p' );
  tempval = form['option150'];
  retval = set_single( 'service.dhcp.option150.0='+tempval, '-p' );
  tempval = form['option160'];
  retval = set_single( 'service.dhcp.option160.0='+tempval, '-p' );
  tempval = form['DHCPrelay'];
  retval = set_single( 'service.dhcp.relay.0='+tempval, '-p' );
  tempval = form['DHCPServerAddr'];
  retval = set_single( 'service.dhcp.relay.server.0='+tempval, '-p' );
  redirect('/DHCP.html?success-1');
 }
 else if(request['QUERY_STRING']=='form3') {
  tempval = form['rdbCmd'];
  //syslog(7,"-------------------------rdbCmd="+tempval );
  set_list( tempval, '-p' );
  redirect('/DHCP.html?success-3');
 }
}
else { /*GET*/
 tempval = get_single( 'service.dhcp.range.0' );
 form['DHCPrange'] = tempval;
 tempval = get_single( 'service.dhcp.enable' );
 form['DHCPenable'] = tempval;
 tempval = get_single( 'service.dhcp.lease.0' );
 form['DHCPLease'] = tempval;
 tempval = get_single( 'service.dhcp.suffix.0' );
 form['DDNsuffix'] = tempval;
 tempval = get_single( 'service.dhcp.dns1.0' );
 form['DNS1'] = tempval;
 tempval = get_single( 'service.dhcp.dns2.0' );
 form['DNS2'] = tempval;
 tempval = get_single( 'service.dhcp.win1.0' );
 form['WINSIP1'] = tempval;
 tempval = get_single( 'service.dhcp.win2.0' );
 form['WINSIP2'] = tempval;
 tempval = get_single( 'service.dhcp.ntp_server.0' );
 form['NTPserver'] = tempval;
 tempval = get_single( 'service.dhcp.tftp_server.0' );
 form['TFTPserver'] = tempval;
 tempval = get_single( 'service.dhcp.option150.0' );
 form['option150'] = tempval;
 tempval = get_single( 'service.dhcp.option160.0' );
 form['option160'] = tempval;
 tempval = get_single( 'service.dhcp.relay.0' );
 form['DHCPrelay'] = tempval;
 tempval = get_single( 'service.dhcp.relay.server.0' );
 form['DHCPServerAddr'] = tempval;
}
%> -->
<div class="header-wrap" id="main-menu"><!--Top Menu--></div>
<div id="content" class="site-content">
<div class="container">
<aside class="grid-3 alpha sidemenu" id="side-menu"><!--Side Menu--></aside>
 <div class="grid-9 omega">
  <form><!--place holder for validation--></form>
  <div class="right-column white-box">
   <form name="form" id="form" class="validate" novalidate method="POST" action="DHCP.html?form1">
   <div class="pad">
    <input type="hidden" name="DHCPrange" value="192.168.1.100,192.168.1.199"/>
    <input type="hidden" name="DHCPenable" value="1"/>
    <input type="hidden" name="DNS1" value=""/>
    <input type="hidden" name="DNS2" value=""/>
    <input type="hidden" name="WINSIP1" value=""/>
    <input type="hidden" name="WINSIP2" value=""/>
    <input type="hidden" name="NTPserver" value=""/>
    <input type="hidden" name="DHCPrelay" value="0">
    <input type="hidden" name="DHCPServerAddr" value="">
    <h2><script language=Javascript>document.write("DHCP relay configuration")</script></h2>
    <div class="form-row no-bg-form">
     <label for="field-2"><script language=Javascript>document.write("DHCP relay")</script></label>
     <div class="field">
      <div class="location-settings">
       <div class="radio-switch">
        <input type="radio" class="access" name='DHCPRelayConf' id='DHCPRelayConf-0' value=1 onClick="ungreyOutRelayFields()">
        <label for="DHCPRelayConf-0" class="on"><script language=Javascript>document.write("I")</script></label>
        <input type="radio" class="access" name='DHCPRelayConf' id='DHCPRelayConf-1' value=0 onClick="greyOutRelayFields()">
        <label for="DHCPRelayConf-1" class="off"><script language=Javascript>document.write("0")</script></label>
       </div>
      </div>
     </div>
    </div>
    <div class="grey-box" id="box_dhcp_relay">
     <div class="form-row">
      <label for="DHCPServerAddr"><script language=Javascript>document.write("DHCP server address")</script></label>
      <script language=javascript>htmlGenIpBlocks("DHCPServerAddr");</script>
     </div>
    </div>
    <div class="box_dhcp_conf">
     <h2><script language=Javascript>document.write("DHCP configuration")</script></h2>
     <div class="form-row no-bg-form">
      <label for="field-1"><script language=Javascript>document.write("DHCP")</script></label>
      <div class="field">
       <div class="location-settings">
        <div class="radio-switch" data-toggle-element="box_dhcp">
         <input type="radio" name='DHCPConf' id='DHCPConf-0' value='1' class="access" onClick="ungreyOutDHCPFields()">
         <label for="DHCPConf-0" class="on"><script language=Javascript>document.write("I")</script></label>
         <input type=radio name='DHCPConf' id='DHCPConf-1' value='0' class="access" onClick="greyOutDHCPFields()">
         <label for="DHCPConf-1" class="off"><script language=Javascript>document.write("0")</script></label>
        </div>
       </div>
      </div>
     </div>
     <div class="grey-box" id="box_dhcp">
      <div class="form-row">
       <label for="DHCPStart"><script language=Javascript>document.write("DHCP start range")</script></label>
       <script language=javascript>htmlGenIpBlocks("DHCPStart");</script>
      </div>
      <div class="form-row">
       <label for="DHCPEnd"><script language=Javascript>document.write("DHCP end range")</script></label>
       <script language=javascript>htmlGenIpBlocks("DHCPEnd");</script>
      </div>
      <div class="form-row">
       <label for="DHCPLease"><script language=Javascript>document.write("DHCP lease time"+"("+"seconds"+")")</script></label>
       <div class="field">
        <input type="text" name="DHCPLease" id="DHCPLease" class="large validate[required,funcCall[validate_DHCPLease] required DHCPLease" maxLength="5" onKeyUp="NumfieldEntry(this);" value="86400">
       </div>
      </div>
      <div class="form-row">
       <label for="DDNsuffix"><script language=Javascript>document.write("Default domain name suffix")</script></label>
       <div class="field">
        <input type="text" name="DDNsuffix" class="large" maxLength="128" value="">
       </div>
      </div>
      <div class="form-row">
       <label for="DNSAddress1"><script language=Javascript>document.write("DNS server 1 IP address")</script></label>
       <script language=javascript>htmlGenIpBlocksWithoutRequired("DNSAddress1");</script>
      </div>
      <div class="form-row">
       <label for="DNSAddress2"><script language=Javascript>document.write("DNS server 2 IP address")</script></label>
       <script language=javascript>htmlGenIpBlocksWithoutRequired("DNSAddress2");</script>
      </div>
      <div class="form-row">
       <label for="WINSIP1"><script language=Javascript>document.write("WINS server 1 IP address")</script></label>
       <script language=javascript>htmlGenIpBlocksWithoutRequired("WINSIP1");</script>
      </div>
      <div class="form-row">
       <label for="WINSIP2"><script language=Javascript>document.write("WINS server 2 IP address")</script></label>
       <script language=javascript>htmlGenIpBlocksWithoutRequired("WINSIP2");</script>
      </div>
      <div class="form-row">
       <label for="NTPserver"><script language=Javascript>document.write("NTP server (Option 42)")</script></label>
       <script language=javascript>htmlGenIpBlocksWithoutRequired("NTPserver");</script>
      </div>
      <div class="form-row">
       <label for="TFTPserver"><script language=Javascript>document.write("TFTP server (Option 66)")</script></label>
       <div class="field">
        <input type="text" name="TFTPserver" class="large" maxLength="128" value="">
       </div>
      </div>
      <div class="form-row">
       <label for="option150"><script language=Javascript>document.write("DHCP option 150")</script></label>
       <div class="field">
        <input type="text" name="option150" class="large" maxLength="128" value=""></td>
       </div>
      </div>
      <div class="form-row">
       <label for="option160"><script language=Javascript>document.write("DHCP option 160")</script></label>
       <div class="field">
        <input type="text" name="option160" class="large" maxLength="128" value="">
       </div>
      </div>
     </div>
    </div>
    <div class="submit-row">
     <button type="button" onClick="javascript:submitF1()"><script language=Javascript>document.write("Save")</script></button>
    </div>
   </div>
   </form>
   <div class="box_dhcp_conf box_reservation pad">
    <div class="hr"></div>
    <br/>
    <form name="form3" class="validate" novalidate method="POST" action="DHCP.html?form3">
     <input type="hidden" name="rdbCmd" value=""/>
     <input type="hidden" value="0" id="maxReservation" name="maxReservation"/>
     <div id="reservationdiv1">
      <div class="grid-50">
       <div class="pad alpha">
        <h2><script language=Javascript>document.write("Address reservation list")</script></h2>
       </div>
      </div>
      <div class="grid-50">
       <div class="pad omega">
        <div class="submit-row-condensed">
         <button type="button" class="secondary sml fr" id="addbutton01" onClick="addElement('','','0.0.0.0',1)"><i class="icon plus"></i><script language=Javascript>document.write("Add")</script></button>
        </div>
       </div>
      </div>
      <br/>
      <div class="form-row">
       <table class="no-border" id="ReservationDiv-title">
        <colgroup>
         <col width="160px">
         <col width="160px">
         <col width="225px">
         <col width="auto">
         <col width="auto">
        </colgroup>
        <thead>
         <tr>
          <th class="align10"><script language=Javascript>document.write("Computer name")</script></th>
          <th class="align10"><script language=Javascript>document.write("MAC address")</script></th>
          <th class="align10"><script language=Javascript>document.write("IP address")</script></th>
          <th class="align10"><script language=Javascript>document.write("Enable")</script></th>
          <th></th>
         </tr>
        </thead>
       </table>
       <div id="ReservationDiv"></div>
      </div>
     </div>
     <div class="submit-row">
      <button type="button" onClick="javascript:submitF3()"><script language=Javascript>document.write("Save")</script></button>
     </div>
    </form>
    <div class="hr"></div>
    <br/>
    <form name="form4" class="validate" action="#" novalidate>
     <h2><script language=Javascript>document.write("Dynamic DHCP client list")</script></h2>
     <table>
      <colgroup>
       <col width="20%">
       <col width="20%">
       <col width="20%">
       <col width="20%">
       <col width="20%">
      </colgroup>
      <thead>
       <tr>
        <th class="align10"><script language=Javascript>document.write("Computer name")</script></th>
        <th class="align10"><script language=Javascript>document.write("MAC address")</script></th>
        <th class="align10"><script language=Javascript>document.write("IP address")</script></th>
        <th class="align10"><script language=Javascript>document.write("Expiry time")</script></th>
        <th></th>
       </tr>
      </thead>
      <tbody id="lease_data"><tr align="left"><td>Rhyans Super Laptop</td><td>00:11:22:33:44:55</td><td>192.168.1.124</td><td>18/02/2015, 16:23:47</td><td class="last"><button onclick="cloneLeasesData('Rhyans Super Laptop','00:11:22:33:44:55','192.168.1.124')" class="secondary sml" type="button"><i class="icon clone"></i>Clone</button></td></tr></tbody>
     </table>
    </form>
   </div>
  </div>
 </div>
</div>
</div>
<footer class="footer">
 <div class="container">
  <p class="copy-right"><script language=Javascript>document.write("Powered by NetComm Wireless Limited")</script></p>
 </div>
</footer>
<script language='javascript'>
        set_menu("Internet", "DHCP", "root");
/********* vdf validator**********/
 VALIDATOR.config.errors["DHCPLease"]="Minimum lease time is 120 seconds";
 $.validator.addMethod("DHCPLease",function(c,a) {
  if(c!==$(a).attr("data-watermark")) {
   if( c < 120 ) {
    return false;
   }
  }
  else if($(a).hasClass("required")) {
   return false;
  }
  return true;
 },VALIDATOR.config.errors.DHCPLease);
/*******************************************/
 if(""=="success-1") {
  success_alert("","Your DHCP configuration changes were successfully saved and applied");
 }
 else if(""=="success-3") {
  success_alert("","Your DHCP address reservation list changes were successfully saved and applied");
 }
</script>
</body>
</html>
