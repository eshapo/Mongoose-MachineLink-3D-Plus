<!doctype html>
<html class="no-js" lang="en">
<!--
  Common include to check the session is current and if not redirect to the
  login page, then after logging in redirect back to the referring page.
  Note a redirect on a non-root user can be effected by defining the
  pre-processor symbol "CHECK_ROOT_USER" before including this file.
-->
<!-- <%
// Check the session, if timed out redirect, and pass the referring page as
// an argument. This allows index.html to redirect back to the referring page.
useSession();
if (
    request["SESSION_ID"] != session["sessionid"]) {
  redirect('/index.html?src=' + request["SCRIPT_NAME"]);
  exit(403);
}
%> -->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>IPSec</title>

<script>
(function() {
 var html = document.documentElement;
 html.className = html.className.replace('no-js','') + ' js';
})();
var modules = [];
</script>
<!--[if lt IE 9]>
<script src="vdf-lib/js/lib/selectivizr.min.js"></script>
<script src="js/libs/html5-shiv.min.js"></script>
<noscript>
 <link rel="stylesheet" href="vdf-lib/css/ie/ie.min.css">
</noscript>
<![endif]-->
<!--[if IE 6]>
<link rel="stylesheet" href="css/ie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" href="css/ie7.css">
<![endif]-->
<!--[if lte IE 7]>
<link rel="stylesheet" href="css/ie6-ie7.css">
<![endif]-->
<link rel="stylesheet" href="vdf-lib/css/main.min.css?2.0.18.9">
<link rel="stylesheet" href="css/style.css?2.0.18.9">
<link rel="stylesheet" href="css/jquery-ui.css">
<link rel="shortcun icon" type="image/x-icon" href="favicon.ico">
</head>
<!--[if IE 6]>
 <body class="ie ie6">
<![endif]-->
<!--[if IE 7]>
 <body class="ie ie7">
<![endif]-->
<!--[if IE 8]>
 <body class="ie ie8">
<![endif]-->
<!--[if IE 9]>
 <body class="ie ie9">
<![endif]-->
<!--[if gt IE 9]>
 <body>
<![endif]-->
<!--[if !IE]><!-->
<body>
<!--<![endif]-->
<script src="js/jquery.min.js?2.0.18.9" type="text/javascript"></script>
<script src="js/jquery.validate.min.js?2.0.18.9" type="text/javascript" charset="utf-8"></script>
<script src="js/script.js?2.0.18.9"></script>
<script src="vdf-lib/js/main.min.js?2.0.18.9"></script>
<!--**********************************************************-->
<script type="text/javascript" src="lang/b28n.js?2.0.18.9"></script>
<script language="JavaScript" src="js/jquery.blockUI.js"></script>
<script src="js/jquery-ui.js"></script>
<script src="js/jquery.ui.touch-punch.min.js"></script>
<script type="text/javascript" src="util.js?2.0.18.9"></script>
<script language='javascript'>
var fn="VPN_ipsec.html".replace(".html", "");
if(fn=="" || fn=="/") {
 fn="index";
}
Butterlate.setTextDomain(fn.replace("/", ""));
$.blockUI.defaults.css.padding="20px 0 20px 0";
var roam_simcard="0";
if(!is_touch_device()) {$("head").append("<style type='text/css'>.footer {position:fixed;}</style>");}
</script>
<script language="JavaScript" src="cgi-bin/ipsec.cgi"></script>
<script language="JavaScript">
/*****************net_util.js************************/
function WinExpIP(field,event) {
 if( field.value=="") {
  if($(field).hasClass("required")) {
   $(field).valid();
  }
 }
 else {
  if(!isValidIpEntry(field,event))
   validate_alert( "", "You must enter a value between 0 and 255. Please try again.");
  else
   clear_alert();
 }
}
function WinExpIP_1(field,event) {
 if( field.value=="") {
  if($(field).hasClass("required")) {
   $(field).valid();
  }
 }
 else {
  switch(isValidIpEntry_1(field,event)) {
  case -1:
   validate_alert( "", "You must enter a value between 1 and 223. Please try again.");
  break;
  case -2:
   validate_alert( "", "An IP address can't start with 127. Please try another value between 1 and 223.");
  break;
  default:
   clear_alert();
  break;
  }
 }
}
function WinExpIP_0(field,event) {
 if( field.value=="") {
  if($(field).hasClass("required")) {
   $(field).valid();
  }
 }
 else {
  if(isNValidIP(field.value))
   validate_alert( "", "Please specify a value between 0 and 255.");
  else
   clear_alert();
 }
}
function WinExpIP_127(field,event) {
 if( field.value=="") {
  if($(field).hasClass("required")) {
   $(field).valid();
  }
 }
 else {
  if(isNValidIP(field.value) || field.value <1 || field.value >223)
   validate_alert( "", "dhcp warningMsg1");
  else
   clear_alert();
 }
}
function hostMin(ip, mask) {
 var host_array=new Array();
 ip_array = ip.split('.');
 mask_array = mask.split('.');
 for (i = 0; i < 4; i++) {
  host_array[i] = parseInt(ip_array[i])&parseInt(mask_array[i]);
 }
 host_array[3]++;
 return host_array.join(".");
}
function hostMax(ip, mask) {
 var host_array=new Array();
 var wildcard_array=new Array();
 ip_array = ip.split('.');
 mask_array = mask.split('.');
 for (i = 0; i < 4; i++) {
  wildcard_array[i]=~parseInt(mask_array[i])&255;
  host_array[i] = parseInt(ip_array[i])&parseInt(mask_array[i])|wildcard_array[i];
 }
 host_array[3]--;
 return host_array.join(".");
}
function checkIPrange(ipMin, ipMax, myip) {
var fromArr = ipMin.split(".");
var toArr = ipMax.split(".");
var myipArr = myip.split(".");
var fromip=0; toip=0; myip=0;
 for(i=0;i<4;i++) {
  fromip=fromip*1000+parseInt(fromArr[i]);
  toip=toip*1000+parseInt(toArr[i]);
  myip=myip*1000+parseInt(myipArr[i]);
 }
 if(myip<fromip || myip>toip) {
  return false;
 }
 return true;
}
function isWithinHostIpRange(ip, mask, myip) {
 return checkIPrange(hostMin(ip, mask), hostMax(ip, mask), myip);
}
function checkIpAddr(field, ismask, msg) {
 if (field.value == "") {
  if (ismask) {
   validate_alert( "", typeof(msg)!="undefined"?msg+"You must enter a netmask. Please try again.":"You must enter a netmask. Please try again.");//The netmask is empty.
  }
  else {
   validate_alert( "", typeof(msg)!="undefined"?msg+"The IP address is empty. Please try again.":"The IP address is empty. Please try again.");//IP address is empty.
  }
  field.value = field.defaultValue;
  field.focus();
  return false;
 }
 if (isAllNum(field.value) == 0) {
  validate_alert( "", typeof(msg)!="undefined"?msg+"You must enter a number between [1-9]. Please try again.":"You must enter a number between [1-9]. Please try again.");//'It should be a [0-9] number.'
  field.value = field.defaultValue;
  field.focus();
  return false;
 }
 if (ismask) {
  if ((!checkRange(field.value, 1, 0, 256)) ||
   (!checkRange(field.value, 2, 0, 256)) ||
   (!checkRange(field.value, 3, 0, 256)) ||
   (!checkRange(field.value, 4, 0, 256)))
  {
   validate_alert( "", typeof(msg)!="undefined"?msg+"You have entered the netmask incorrectly. Please try again.":"You have entered the netmask incorrectly. Please try again.");//'The netmask has wrong format.'
   field.value = field.defaultValue;
   field.focus();
   return false;
  }
 }
 else {
  if ((!checkRange(field.value, 1, 0, 255)) ||
   (!checkRange(field.value, 2, 0, 255)) ||
   (!checkRange(field.value, 3, 0, 255)) ||
   (!checkRange(field.value, 4, 1, 254)))
  {
   if (ismask) {
    validate_alert( "", typeof(msg)!="undefined"?msg+"You have entered the netmask incorrectly. Please try again.":"You have entered the netmask incorrectly. Please try again.");//'The netmask has wrong format.'
   }
   else {
    validate_alert( "", typeof(msg)!="undefined"?msg+"You have entered the IP address incorrectly. Please try again.":"You have entered the IP address incorrectly. Please try again.");//'IP adress format error.'
   }
   field.value = field.defaultValue;
   field.focus();
   return false;
  }
 }
 clear_alert();
 return true;
}
function parse_ip_into_fields(ipaddr, name) {
 var i;
 var ip_array;
 ip_array=ipaddr.split(".");
 if(ip_array.length != 4 ) {ip_array[0]=''; ip_array[1]='';ip_array[2]=''; ip_array[3]='';}
 for(i=0;i<4;i++) {
  $("input[name="+name+(i+1)+"]").val(ip_array[i]||"");
 }
}
function parse_ip_from_fields(documentItem) {
 var ip_array=new Array();
 var val;
 var j=0;
 for(var i=0;i<4;i++) {
  val=$("input[name="+documentItem+(i+1)+"]").val();
  if(val!="") {
   ip_array[j++]=val;
  }
 /*	else {
			return "";
		}*/
 }
 return ip_array.join(".");
}
function ValidSubnetMask(n, t){
 NumfieldEntry(t);
 if(isValidSubnetMask(parse_ip_from_fields(n))<0) {
  for(i=0;i<4;i++) {
   $("input[name="+n+(i+1)+"]").removeClass("success-text").addClass("failure-text");
  }
 }
 else {
  for(i=0;i<4;i++) {
   $("input[name="+n+(i+1)+"]").removeClass("failure-text").addClass("success-text");
  }
 }
}
function htmlGenIpBlocks(name_in) {
 h="<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"1' id='"+name_in+"1' onkeyup='NumfieldEntry(this);WinExpIP_1(this,event)'></div>	<label for='"+name_in+"1' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"2' id='"+name_in+"2' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"2' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"3' id='"+name_in+"3' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"3' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"4' id='"+name_in+"4' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"4' class='input-connect-dot'></label>";
 printf(h);
}
function htmlGenIpBlocks0(name_in) {
 h="<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"1' id='"+name_in+"1' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"1' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"2' id='"+name_in+"2' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"2' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"3' id='"+name_in+"3' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"3' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"4' id='"+name_in+"4' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"4' class='input-connect-dot'></label>";
 printf(h);
}
function htmlGenIpBlocks127(name_in) {
 h="<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"1' id='"+name_in+"1' onkeyup='NumfieldEntry(this);WinExpIP_127(this,event)'></div>	<label for='"+name_in+"1' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"2' id='"+name_in+"2' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"2' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"3' id='"+name_in+"3' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"3' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='"+name_in+"4' id='"+name_in+"4' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"4' class='input-connect-dot'></label>";
 printf(h);
}
function htmlGenMaskBlocks(name_in) {
 printf("<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='%s1' id='%s1' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label for='"+name_in+"1' class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='%s2' id='%s2' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label for='"+name_in+"2' class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='%s3' id='%s3' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label for='"+name_in+"3' class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='required ip-adress' maxLength='3' name='%s4' id='%s4' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label for='"+name_in+"4' class='input-connect-dot'></label>");
}
function htmlGenIpBlocksWithoutRequired(name_in) {
 h="<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"1' id='"+name_in+"1' onkeyup='NumfieldEntry(this);WinExpIP_1(this,event)'></div>	<label for='"+name_in+"1' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"2' id='"+name_in+"2' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"2' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"3' id='"+name_in+"3' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"3' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"4' id='"+name_in+"4' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>	<label for='"+name_in+"4' class='input-connect-dot'></label>";
 printf(h);
}
function htmlGenIpBlocksWithoutRequired0(name_in) {
 h="<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"1' id='"+name_in+"1' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"1' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"2' id='"+name_in+"2' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"2' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"3' id='"+name_in+"3' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"3' class='input-connect-dot'>.</label>	<div class='field'><input type='text' class='ip-adress' maxLength='3' name='"+name_in+"4' id='"+name_in+"4' onkeyup='NumfieldEntry(this);WinExpIP_0(this,event)'></div>	<label for='"+name_in+"4' class='input-connect-dot'></label>";
 printf(h);
}
function htmlGenMaskBlocksWithoutRequired(name_in) {
 printf("<div class='field'><input type='text' class='ip-adress' maxLength='3' name='%s1' id='%s1' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='ip-adress' maxLength='3' name='%s2' id='%s2' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='ip-adress' maxLength='3' name='%s3' id='%s3' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label class='input-connect-dot'>.</label>");
 printf("<div class='field'><input type='text' class='ip-adress' maxLength='3' name='%s4' id='%s4' onkeyup='NumfieldEntry(this);WinExpIP(this,event)'></div>",name_in,name_in);
 printf("<label class='input-connect-dot'></label>");
}
/******************End of net_util.js***********************/
var actTunnelNum=0;
var ipsecTunnelMap=new Array();
function exitHandler() {
 show_ipsec_profile();
}
function hasSubStr(str, substr) {
 return str.search(substr) >= 0;
}
function checkIpsecForm() {
 var f=document.form;
 var vpnserver=f.vpnserver.value;
 if(!is_valid_domain_name(vpnserver) && !isValidIpAddress(f.vpnserver.value)) {
  validate_alert("","Error: You have entered the server address incorrectly. Please try again.");//Error: No server IP address entered or not entered correctly
  return false;
 }
 return true;
 var keyMode = f.IpSecMethod.value;
 if (keyMode == "")
  keyMode = "none";
 if ((keyMode != "none") &&
  ((f.remote_lan1.value == "") ||
  (f.remote_lan2.value == "") ||
  (f.remote_lan3.value == "") ||
  (f.remote_lan4.value == "") ||
  (f.remote_mask1.value == "") ||
  (f.remote_mask2.value == "") ||
  (f.remote_mask3.value == "") ||
  (f.remote_mask4.value == "") ||
  (f.local_lan1.value == "") ||
  (f.local_lan2.value == "") ||
  (f.local_lan3.value == "") ||
  (f.local_lan4.value == "") ||
  (f.local_mask1.value == "") ||
  (f.local_mask2.value == "") ||
  (f.local_mask3.value == "") ||
  (f.local_mask4.value == ""))) {
  blockUI_alert("Error: You must complete all IP addresses and mask values for local and gateway configuration fields");//All IP address and mask values for local and gateway must be filled in.
  return;
 }
 if (keyMode == "psk") {
  if (f.PskValue.value == "") {
   blockUI_alert("Please enter a PSK password for the PSK key mode");//Key Mode PSK requires a PSK Password.
   return false;
  }
 }else if(keyMode == "rsa") {
   //nothing to check
 }
 else if (keyMode == "cert") {
  if (f.KeyPassword.value == "") {
   blockUI_alert("You should protect your secret private key with a password");//Your secret private key should be protected by a password.
   return false;
  }
 }
 if(isNaN(parseInt(f.IpsecLifeTime.value)) == true){
  blockUI_alert("Please enter a valid life time number");//You need to input a valid lifetime number.
  return false;
 }
 if(isNaN(parseInt(f.IpsecIkeTime.value)) == true){
  blockUI_alert("Please enter a valid IKE time number");//You need to input a valid iketime number.
  return false;
 }
 if(isNaN(parseInt(f.DpdTimeout.value)) == true){
  blockUI_alert("Please enter a valid DPD timeout number");//You need to input a valid dpd timeout number.
  return false;
 }
 if(isNaN(parseInt(f.DpdTimeDelay.value)) == true){
  blockUI_alert("Please enter a valid DPD keep alive time");//You need to input a valid dpd keep alive time.
  return false;
 }
 return true;
}
function isValidIpAddress(str) {
 regaddr=/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/
 return regaddr.exec(str)!=null;
}
function submitIpsecForm() {
 var f=document.form;
 var header = "&link.profile."+i+".";
 f.rdbCmd.value = "link.profile."+i+".dev=ipsec.0"
 +header+"enable="+$("input:radio.access[name=vpnenable]:checked").val()
 +header+"name="+f.newname.value
 +header+"remote_gateway="+f.vpnserver.value
 +header+"remote_lan="+f.remote_lan.value
 +header+"remote_mask="+f.remote_mask.value
 +header+"local_lan="+f.local_lan.value
 +header+"local_mask="+f.local_mask.value
 +header+"enccap_protocol="+f.ipsecEncap.value
 +header+"ike_mode="+f.ipsec_ikemode.value
 +header+"pfs="+f.ipsec_pfs.value
 +header+"ike_enc="+f.ipsec_ikeenc.value
 +header+"ike_hash="+f.ipsec_ikehash.value
 +header+"ipsec_enc="+f.ipsec_enc.value
 +header+"ipsec_hash="+f.ipsec_hash.value
 +header+"ipsec_dhg="+f.ipsec_dhg.value
 +header+"ipsec_dpd="+f.ipsec_dpdaction.value
 +header+"dpd_time="+f.DpdTimeDelay.value
 +header+"dpd_timeout="+f.DpdTimeout.value
 +header+"ike_time="+f.IpsecIkeTime.value
 +header+"life_time="+f.IpsecLifeTime.value
 +header+"ipsec_method="+f.IpSecMethod.value
 +header+"psk_value="+f.PskValue.value
 +header+"psk_remoteid="+f.PskRemoteId.value
 +header+"psk_localid="+f.PskLocalId.value
 +header+"rsa_remoteid="+f.RsaRemoteId.value
 +header+"rsa_localid="+f.RsaLocalId.value
 +header+"key_password="+f.KeyPassword.value
 +"&ipsec.0.profile="+i
 +header+"delflag=0"
 +"&ipsec.1.old_local_lan="+f.old_local_lan.value
 +"&ipsec.1.old_local_lan_mask="+f.old_local_lan_mask.value
 +"&ipsec.1.old_remote_lan="+f.old_remote_lan.value
 +"&ipsec.1.old_remote_lan_mask="+f.old_remote_lan_mask.value
 +"&ipsec.1.old_remote_gateway="+f.old_remote_gateway.value
 +"&ipsec.1.new_remote_gateway="+f.vpnserver.value
 +"&ipsec.1.new_local_lan="+f.local_lan.value
 +"&ipsec.1.new_local_lan_mask="+f.local_mask.value
 +"&ipsec.1.new_remote_lan="+f.remote_lan.value
 +"&ipsec.1.new_remote_lan_mask="+f.remote_mask.value;
 f.submit();
}
function submitForm() {
 var f=document.form;
 clear_alert();
/********* vdf validator**********/
 if(!$("#form").valid()) {
  return;
 }
 f.vpnserver.value = f.vpnserver_in.value;
 f.remote_lan.value = f.remote_lan1.value + "." + f.remote_lan2.value + "." + f.remote_lan3.value + "." + f.remote_lan4.value;
 f.remote_mask.value = f.remote_mask1.value + "." + f.remote_mask2.value + "." + f.remote_mask3.value + "." + f.remote_mask4.value;
 f.local_lan.value = f.local_lan1.value + "." + f.local_lan2.value + "." + f.local_lan3.value + "." + f.local_lan4.value;
 f.local_mask.value = f.local_mask1.value + "." + f.local_mask2.value + "." + f.local_mask3.value + "." + f.local_mask4.value;
 try {
  document.form.rdbCmd.value = "";
  if ($("input:radio.access[name=vpnenable]:checked").val() == '1') {
   if(!checkIpsecForm())
    return;
  }
  value = parseInt(f.editindex.value);
  if( st.length==0 || isNaN(value)==true || value < 0 || value >= st.length ) {
   i = newprofilenum; //add new
  }
  else if( isNaN(st[value].profilenum)==true ) {
   blockUI_alert("Error: You have entered the profile number incorrectly. Please try again."); //Error: Profile number incorrectly
   return;
  }
  else {
   i=st[value].profilenum;
  }
  submitIpsecForm();
 }
 catch(e) {
  alert(e.message);
 }
}
function delentry( index ) {
 try {
  i=st[index].profilenum;
  document.form.rdbCmd.value = "link.profile."+i+".name=&link.profile."+i+".enable=0&link.profile."+i+".delflag=1";
  document.form.submit();
 }
 catch(e) {
  alert(e.message);
 }
}
function Ipseclist() {
 var tunnel_num = 0;
 var st=[ ]; newprofilenum =7; 
 actTunnelNum=0;
 /* Go through tunnel list and work out how many are IPsec */
 for (var i = 0; i < st.length; i++) {
  if ((st[i].type=="ipsec.0")) {
   tunnel_num++;
   if(st[i].enable=="1") {
    ipsecTunnelMap[actTunnelNum] = i;
    actTunnelNum ++;
   }
  }
 }
 /* If the list is empty don't setup the columns, just return */
 if (tunnel_num == 0) {
  document.write("<br/><table class='empty above-5-column'>");
  document.write("<thead><tr><th>" + "The IPSec tunnel list is empty"+ "</th></tr></thead>");
  document.write("</table>");
  return;
 }
 /* Display the headings for the table here */
 document.write("<thead>");
 document.write("<tr>");
 document.write("<th class='align10'>#</th>");
 document.write("<th class='align10'>"+"Name"+"</th>");
 document.write("<th class='align10'>"+"Remote LAN address/mask"+"</th>");
 document.write("<th class='align10'>"+"Remote gateway"+"</th>");
 document.write("<th class='align10'>"+"Local LAN address/mask"+"</th>");
 document.write("<th class='align10'>"+"Enable"+"</th>");
 document.write("<th class='align10'>"+"Edit"+"</th>");
 document.write("<th></th>");
 document.write("</thead><tbody>");
 //document.form2.stlength.value = st.length;
 for (i = 0; i < st.length; i++) {
  if((st[i].type=="ipsec.0")) {
   document.write("<tr>");
   document.write("<td>"+tunnel_num+"</td>");
   document.write("<td style='word-wrap:break-word;width:36px;'>"+breakWord(st[i].name, 7)+"</td>");
   document.write("<td>"+st[i].remote_lan+"/"+maskBits(st[i].remote_mask)+"</td>");
   document.write("<td>"+st[i].remote_gateway+"</td>");
   document.write("<td>"+st[i].local_lan+"/"+maskBits(st[i].local_mask)+"</td>");
   document.write("<td>"+(st[i].enable=='1'?'enabled':'disabled')+"</td>");
   document.write("<td><a class='secondary sml' href='javascript:clear_alert();show_ipsec_profile("+i+");'><i class='icon edit'>"+"Edit"+"</i></a></td>");
   document.write("<td class='last' style='padding:0'><a class='secondary sml' style='padding:0;margin:0;border:0;' href='javascript:delentry("+i+");' title='"+"Delete"+"'><i class='icon close'></i></a></td>");
   document.write("</tr>");
  }
 }
 document.write("</tbody>");
}
function initIpsecForm(idx) {
 var f=document.form;
 var st=[ ]; newprofilenum =7; 
 load_value_to_element("input:radio.access[name=vpnenable]",st[idx].enable==1);
 f.newname.value=st[idx].name;
 f.vpnserver.value=st[idx].remote_gateway;
 f.remote_lan.value=st[idx].remote_lan;
 f.remote_mask.value=st[idx].remote_mask;
 f.local_lan.value=st[idx].local_lan;
 f.local_mask.value=st[idx].local_mask;
 f.ipsecEncap.value=st[idx].enccap_protocol;
 f.ipsec_ikemode.value=st[idx].ike_mode;
 f.ipsec_pfs.value=st[idx].pfs;
 f.ipsec_ikeenc.value=st[idx].ike_enc;
 f.ipsec_ikehash.value=st[idx].ike_hash;
 f.ipsec_enc.value=st[idx].ipsec_enc;
 f.ipsec_hash.value=st[idx].ipsec_hash;
 f.ipsec_dhg.value=st[idx].ipsec_dhg;
 f.ipsec_dpdaction.value=st[idx].ipsec_dpd;
 f.DpdTimeDelay.value=st[idx].dpd_time;
 f.DpdTimeout.value=st[idx].dpd_timeout;
 f.IpsecIkeTime.value=st[idx].ike_time;
 f.IpsecLifeTime.value=st[idx].life_time;
 f.IpSecMethod.value=st[idx].ipsec_method;
 f.PskValue.value=st[idx].psk_value;
 f.PskRemoteId.value=st[idx].psk_remoteid;
 f.PskLocalId.value=st[idx].psk_localid;
 f.RsaRemoteId.value=st[idx].rsa_remoteid;
 f.RsaLocalId.value=st[idx].rsa_localid;
 f.KeyPassword.value=st[idx].key_password;
 f.old_local_lan.value=f.local_lan.value;
 f.old_local_lan_mask.value=f.local_mask.value;
 f.old_remote_lan.value=f.remote_lan.value;
 f.old_remote_lan_mask.value=f.remote_mask.value;
 f.old_remote_gateway.value=f.vpnserver.value;
 var f = document.form;
 $("#vpnserver_in").val(f.vpnserver.value);
 parse_ip_into_fields(f.remote_lan.value, "remote_lan");
 parse_ip_into_fields(f.remote_mask.value, "remote_mask");
 parse_ip_into_fields(f.local_lan.value, "local_lan");
 parse_ip_into_fields(f.local_mask.value, "local_mask");
 $("#IpSecMethod").trigger("change");
}
function initEmptyForm(idx) {
 var f=document.form;
 load_value_to_element("input:radio.access[name=vpnenable]",true);
 f.newname.value='';
 f.vpnserver.value='';
 f.remote_lan.value='';
 f.remote_mask.value='255.255.255.0';
 f.local_lan.value='';
 f.local_mask.value='255.255.255.0';
 f.ipsecEncap.value="esp";
 f.ipsec_ikemode.value="main";
 f.ipsec_pfs.value="on";
 f.ipsec_ikeenc.value="any";
 f.ipsec_ikehash.value="any";
 f.ipsec_enc.value="any";
 f.ipsec_hash.value="any";
 f.ipsec_dhg.value="any";
 f.ipsec_dpdaction.value="hold";
 f.DpdTimeDelay.value="10";
 f.DpdTimeout.value="60";
 f.IpSecMethod.value="psk";
 f.PskValue.value="";
 f.PskRemoteId.value="";
 f.PskLocalId.value="";
 f.RsaRemoteId.value="";
 f.RsaLocalId.value="";
 f.KeyPassword.value="";
 f.IpsecIkeTime.value="3600";
 f.IpsecLifeTime.value="28800";
 $("#vpnserver_in").val(f.vpnserver.value);
 parse_ip_into_fields(f.remote_lan.value, "remote_lan");
 parse_ip_into_fields(f.remote_mask.value, "remote_mask");
 parse_ip_into_fields(f.local_lan.value, "local_lan");
 parse_ip_into_fields(f.local_mask.value, "local_mask");
 $("#IpSecMethod").trigger("change");
}
// This routine translates an IP address (i.e in 192.168,etc form) to the individual
// segments needed to fill in the form in the web browser
function parse_ip_into_fields(ipAddress, documentItem) {
 var i;
 var ip_array;
 ip_array=ipAddress.split(".");
 for(i=0;i<4;i++) {
  $("input[name="+documentItem+(i+1)+"]").val(ip_array[i]||"0");
 }
}
function show_edit_mode(edit_mode) {
 // hide the profile list in edit mode. otherwise show
 $("#editDiv,#editDiv1,#saveDiv").toggle(edit_mode);
 $("#listDiv").toggle(!edit_mode);
}
function show_current_ipsec_profile() {
 var edit_mode;
 idx=$("#editindex").val();
 // idx has to be bigger than 0 (all extra profile start from 4)
 edit_mode=!isNaN(parseInt(idx));
 if(edit_mode) {
  initEmptyForm(idx);
  initIpsecForm(idx);
  UpdateIpsecCertInfo();
 }
 show_edit_mode(edit_mode);
}
function add_ipsec_profile() {
	var st=[ ]; newprofilenum =7; 
 //clear_alert();
 // change current index to the new
 $("#editindex").val(st.length);
 // wipe out the open vpn form
 initEmptyForm();
 // start polling vpn information
 UpdateIpsecCertInfo();//alert();
 // show edit mode
 show_edit_mode(true);
}
function show_ipsec_profile(idx) {
 clear_alert();
 $("#editindex").val((idx===undefined)?"":idx);
 show_current_ipsec_profile();
}
function readElement(elementName) {
 var element;
 element=document.getElementById(elementName);
 if( (typeof(element)=="undefined") || (element==null) ) {
  alert("not found - " + elementName);
  return "";
 }
 return document.getElementById(elementName).value;
}
function enableElement(elementName,ena) {
 document.getElementById(elementName).disabled=!ena;
 if(ena) {
  $("#elementName").blur();
 }
}
function checkElement(elementName,check) {
 document.getElementById(elementName).checked=check;
}
function showElement(elementName,show) {
 document.getElementById(elementName).style['display']=show?"":"none";
}
function createAjax() {
 var ajaxHttp;
 try {
  ajaxHttp = new ActiveXObject("Microsoft.XMLHTTP");
 }
 catch (e) { // Internet Explorer
  try {
   ajaxHttp = new ActiveXObject("Msxml2.XMLHTTP");
  }
  catch (e) {
   try {
    // Firefox, Opera 8.0+, Safari
    ajaxHttp = new XMLHttpRequest();
   }
   catch (e) {
    alert("Your browser does not support AJAX!");
    return false;
   }
  }
 }
 return ajaxHttp;
}
function UpdateIpsecCertInfo() {
	var st=[ ]; newprofilenum =7; 
 editIndex = document.form.editindex.value;
 if(editIndex<st.length)
  profileNum= st[editIndex].profilenum;
 else
  profileNum=newprofilenum;
  var responseText = "IPSRsaKeyValid='nofile'; IPSRsaLocalCertValid=\"nofile\"; IPSRsaRemoteCertValid=\"nofile\"; IPSRsaCACertValid=\"nofile\"; IPSRsaCRLCertValid=\"optional\"; curDate=\"2014-05-27\"; curTime=\"14:23:16\"; var result='ok'";
// var req="/cgi-bin/ipsec_action.cgi?action=certinfo&param="+ profileNum;
// var ajaxRmClient = createAjax();

  var result;
  ipsec_clear_cert_info();
  $('#keyText').html(responseText);
  eval(responseText);
  if ( typeof(result)=="undefined" || result!="ok" ) {
   alert("failed");
   return;
  }
  setCertificateText();

// document.body.style.cursor = 'wait';
// ajaxRmClient.open('GET', req, true);
// ajaxRmClient.send(null);
}
function ipsecRmCertBtnClick() {
 certiName=document.getElementById("ipsecCertiName").value;
 var req="/cgi-bin/ipsec_action.cgi?action=rmcert&param="+certiName;
 var ajaxRmClient = createAjax();
 ajaxRmClient.onreadystatechange = function() {
  if (ajaxRmClient.readyState != 4) {
   return;
  }
  document.getElementById(" ipsecRmCertBtn").disabled = false;
  document.body.style.cursor = 'default';
  if (ajaxRmClient.status != 200) {
   return;
  }
  var result;
  eval(ajaxRmClient.responseText);
  if ( typeof(result)=="undefined" || result!="ok" ) {
   alert("failed");
   return;
  }
 }
 document.getElementById(" ipsecRmCertBtn").disabled = true;
 document.body.style.cursor = 'wait';
 ajaxRmClient.open('GET', req, true);
 ajaxRmClient.send(null);
}
function ipsecSecretKeyGenBtnClick() {
 function confirmed_func() {
  editIndex = document.form.editindex.value;
  var st=[ ]; newprofilenum =7; 
  var req="/cgi-bin/ipsec_action.cgi?action=genrsa&param="+ st[editIndex].profilenum;
  var ajaxGenRsa = createAjax();
  ajaxGenRsa.onreadystatechange = function() {
   if (ajaxGenRsa.readyState != 4) {
    return;
   }
   document.getElementById("ipsecSecretKeyGenBtn").disabled = false;
   document.body.style.cursor = 'default';
   if (ajaxGenRsa.status != 200) {
    return;
   }
   var result;
   eval(ajaxGenRsa.responseText);
   if ( typeof(result)=="undefined" || result!="ok" ) {
    alert("failed");
    return;
   }
  }
  document.getElementById("ipsecSecretKeyGenBtn").disabled = true;
  document.body.style.cursor = 'wait';
  ajaxGenRsa.open('GET', req, true);
  ajaxGenRsa.send(null);
 }
 blockUI_confirm_l("Please make sure IPSec is running with at least one tunnel configured before you generate RSA keys. To do this, click on 'Save' on the IPsec page before proceeding."+"</br></br>"+"Please note that generating RSA keys will erase any previously generated keys. Click on 'OK' to continue or 'Cancel' to go back.", confirmed_func);
}
function ipsecDnRsaBtnClick() {
	var st=[ ]; newprofilenum =7; 
 editIndex = document.form.editindex.value;
 document.getElementById("ipsec_dn_action").value="dnrsa";
 document.getElementById("ipsec_dn_param").value= st[editIndex].profilenum;
 document.getElementById("formIpsecActionDn").submit();
}
function ipsecCertiUpFileChange() {
 var f1 = document.getElementById("ipsecCertiUpFile").value;
 var end = f1.indexOf(".pem");
 if(end == -1){
  end = f1.indexOf(".crt");
  if(end == -1) {
   end = f1.indexOf(".key");
   if(end == -1) {
    blockUI_alert("You have chosen the wrong file type. Files must end in .crt, .key or .pem. Please try again.");//Error: Wrong Type of File! File must end in .crt, .key or .pem
    document.getElementById("ipsecCertiUpParam").disabled= true;
    return;
   }
  }
 }
 var rc=document.getElementById("uploadFileType").value;
 var st=[ ]; newprofilenum =7; 
 selected=document.getElementById("ipsecCertiUpFile").value.length>0;
 document.getElementById("ipsecCertiUpBtn").disabled=!selected;
 editIndex = document.form.editindex.value;
 if(editIndex<st.length)
  profileNum= st[editIndex].profilenum;
 else
  profileNum=newprofilenum;
 certFileName = document.getElementById("ipsecCertiUpFile").value;
 document.getElementById("ipsecCertiUpParam").value= profileNum+ "&"+certFileName + "&"+rc ;
}
function ipsecRsaUpFileChange() {
	var st=[ ]; newprofilenum =7; 
 editIndex = document.form.editindex.value;
 selected=document.getElementById("ipsecRsaUpFile").value.length>0;
 document.getElementById("ipsecRsaUpParam").value= st[editIndex].profilenum;
 document.getElementById("ipsecRsaUpBtn").disabled=!selected;
 var f1 = document.getElementById("ipsecRsaUpFile").value;
 var end = f1.indexOf(".key");
 if(end == -1){
  blockUI_alert("You have chosen the wrong file type. Files must end in .key. Please try again.");//Error: Wrong Type of File! File must end in .key
  document.getElementById("ipsecRsaUpBtn").disabled= true;
 }
}
function ipsecLocalRsaUpFileChange() {
	var st=[ ]; newprofilenum =7; 
 editIndex = document.form.editindex.value;
 selected=document.getElementById("ipsecLocalRsaUpFile").value.length>0;
 document.getElementById("ipsecLocalRsaUpParam").value= st[editIndex].profilenum;
 document.getElementById("ipsecLocalRsaUpBtn").disabled=!selected;
 var f1 = document.getElementById("ipsecLocalRsaUpFile").value;
 var end = f1.indexOf(".key");
 if(end == -1) {
  blockUI_alert("You have chosen the wrong file type. Files must end in .key. Please try again.");//Error: Wrong Type of File! File must end in .key
  document.getElementById("ipsecLocalRsaUpBtn").disabled= true;
 }
}
var upload_running=false;
function ipsecUploadTargetStart(form) {
 form.target = "uploadTarget";
//	document.getElementById("uploadTarget").onload = ipsecUploadTargetOnLoad;
 form.submit();
 enableElement("ipsecRsaUpBtn",false);
 enableElement("ipsecLocalRsaUpBtn",false);
 enableElement("ipsecCertiUpBtn",false);
 blockUI_wait("Please wait");
 upload_running=true;
}
function resetForm(formName) {
 document.getElementById(formName).reset();
}
function ipsecUploadTargetOnLoad() {
 if(upload_running) {
  //Function will be called when iframe is loaded
  $.unblockUI();
  var ret = frames['uploadTarget'].document.getElementsByTagName("body")[0].innerHTML;
  //window.location.reload(true);
  eval(ret);
  if ( typeof(result)=="undefined" || result!="ok" ) {
   blockUI_alert("Error: the upload has failed. Please check the connection to the router and try again.");//The upload operation has failed. Please ensure the connection to the router
   return;
  }
  document.body.style.cursor = 'default';
  UpdateIpsecCertInfo();
  //reset cert
  resetForm("formIpsecCertiUp");
  // reset rsa
  resetForm("formIpsecRsaUp");
  // reset Local rsa
  resetForm("formIpsecLocalRsaUp");
  $("#ipsecLocalRsaUpBtn").blur();
  $("#ipsecRsaUpBtn").blur();
  $("#ipsecCertiUpBtn").blur();
 }
 upload_running=false;
}
function ipsec_div_display(id, display) {
 if(document.getElementById){
  var el = document.getElementById(id);
  el.style.display = display ? '' : 'none';
 }
}
function ipsecKeyModeEnable(mode) {
 ipsec_div_display("ipsecPresharedKeyDiv", mode == "psk");
 ipsec_div_display("ipsecRsaKeyDiv", mode == "rsa");
 ipsec_div_display("ipsecRemoteRsaDiv", mode == "rsa");
 ipsec_div_display("ipsecLocalRsaDiv", mode == "rsa");
 ipsec_div_display("ipsecCertsDiv", mode == "cert");
 ipsec_div_display("ipsecFormCertDiv", mode == "cert");
}
function certValidToString(val) {
 if (val == "ok")
  return "Uploaded";
 else if (val == "nofile")
  return "Not uploaded";
 else if (val == "wrongformat")
  return "The certificate was uploaded, but it isn't in a valid format (invalid PKCS No.1 format)";//Upload but not valid (e.g. not PKCS#1)
 else if (val == "optional")
  return "(optional)";
 return "Invalid";//Invalid
}
function ipsec_clear_cert_info() {
 IPSRsaLocalCertValid="nofile";
 IPSRsaRemoteCertValid="nofile";
 IPSRsaKeyValid="nofile";
 IPSRsaCACertValid="nofile";
 IPSRsaCRLCertValid="optional";
}
function setCertificateText() {
 var StrToDisplay;
 var uploadfiletype=document.getElementById("uploadFileType").value;
 if(uploadfiletype=="key")
  StrToDisplay=certValidToString(IPSRsaKeyValid);
 else if(uploadfiletype=="local")
  StrToDisplay=certValidToString(IPSRsaLocalCertValid);
 else if(uploadfiletype=="remote")
  StrToDisplay=certValidToString(IPSRsaRemoteCertValid);
 else if(uploadfiletype=="ca")
  StrToDisplay=certValidToString(IPSRsaCACertValid);
 else if(uploadfiletype=="crls")
  StrToDisplay=certValidToString(IPSRsaCRLCertValid);
 $('#certUploadMsg').html(StrToDisplay);
}
function setKeyMode() {
 var method = document.form.IpSecMethod.value;
 ipsecKeyModeEnable(method);
}
function getCheckedValue(radioObj) {
 if(!radioObj) {
  return "";
 }
 var radioLength = radioObj.length;
 if(radioLength == undefined)
  if(radioObj.checked)
   return radioObj.value;
  else
   return "";
 for(var i = 0; i < radioLength; i++) {
  if(radioObj[i].checked) {
   return radioObj[i].value;
  }
 }
 return "";
}
var SITE = SITE || {};
SITE.fileInputs = function() {
 var $this = $(this),
 $val = $this.val(),
 valArray = $val.split('\\'),
 newVal = valArray[valArray.length-1],
 $button = $this.siblings('.button'),
 $fakeFile = $this.siblings('.file-holder');
 if(newVal !== '') {
  $button.text("File chosen");
  if($fakeFile.length === 0) {
   $button.after("<span class='file-holder'>"+newVal+"</span>");
  }
  else {
   $fakeFile.text(newVal);
  }
 }
};
$(document).ready( function() {
 $(".file-wrapper input[type=file]").bind("change focus click", SITE.fileInputs);
 show_current_ipsec_profile();
});
</script>
<!-- <%
if (request['REQUEST_METHOD'] == "POST") {
 tempval = form['rdbCmd'];
 if( tempval != "" ) {
  set_list( tempval, '-p' );
 }
 redirect('/VPN_ipsec.html?success');
}
%> -->
<div class="header-wrap" id="main-menu"><!--Top Menu--></div>
<div id="content" class="site-content">
<div class="container">
 <aside class="grid-3 alpha sidemenu" id="side-menu"><!--Side Menu--></aside>
 <div class="grid-9 omega">
  <div class="grid-9 alpha pppoeEnablesMsg" style="display:none">
   <div class="note-lrg">
    <div class="wrap alert clearfix">
     <h2><script language=Javascript>document.write("Transparent bridge mode (PPPoE) is enabled")</script></h2>
     <p><script language=Javascript>document.write("This function isn't available while you're using transparent bridge mode")</script></p>
    </div>
   </div>
  </div>
  <form><!--place holder for validation--></form>
  <div class="right-column white-box  hide_for_pppoe_en">
  <form name="form" id="form" class="validate" method="POST" action="VPN_ipsec.html">
   <div class="hide_for_pppoe_en">
    <input type="hidden" id="editindex" name="editindex" value="">
    <div id="listDiv" style="display:none">
     <div class="grid-33">
      <div class="pad alpha">
       <h2><script language=Javascript>document.write("IPSec tunnel list")</script></h2>
      </div>
     </div>
     <div class="grid-66">
      <div class="pad omega">
       <div class="submit-row-condensed">
        <button type="button" class="secondary sml fr" onClick="javascript:add_ipsec_profile()"><i class="icon plus"></i><script language=Javascript>document.write("Add")</script></button>
       </div>
      </div>
     </div>
    <!-- Display a table of IPsec Clients -->
    <br/>
    <table class='above-5-column'>
     <script language="JavaScript">Ipseclist();</script>
    </table>
    </div>
    <div id="editDiv" style="display:none">
     <input type="hidden" name="vpnserver" id="vpnserver"/>
     <input type="hidden" name="remote_lan" id="remote_lan"/>
     <input type="hidden" name="remote_mask" id="remote_mask"/>
     <input type="hidden" name="local_lan" id="local_lan"/>
     <input type="hidden" name="local_mask" id="local_mask"/>
     <input type="hidden" name="old_local_lan" id="old_local_lan"/>
     <input type="hidden" name="old_local_lan_mask" id="old_local_lan_mask"/>
     <input type="hidden" name="old_remote_lan" id="old_remote_lan"/>
     <input type="hidden" name="old_remote_lan_mask" id="old_remote_lan_mask"/>
     <input type="hidden" name="old_remote_gateway" id="old_remote_gateway"/>
     <input type="hidden" name="rdbCmd"/>
     <div class="row">
      <div class="grid-33">
       <div class="pad alpha">
        <h2><script language=Javascript>document.write("IPSec profile edit")</script></h2>
       </div>
      </div>
     </div>
     <div class="grey-box" id="box_2144_pin">
      <div class="form-row no-bg-form">
       <label for="field-1"><script language=Javascript>document.write("IPSec profile")</script></label>
       <div class="field">
        <div class="location-settings">
         <div id="vpnEnable" class="radio-switch">
          <input type="radio" id="radio-1" name="vpnenable" class="access" value=1>
          <label for="radio-1" class="on"><script language=Javascript>document.write("I")</script></label>
          <input type="radio" id="radio-2" name="vpnenable" class="access" value=0>
          <label for="radio-2" class="off"><script language=Javascript>document.write("0")</script></label>
         </div>
        </div>
       </div>
      </div>
      <div class="form-row">
       <label for="newname"><script language=Javascript>document.write("Profile name")</script></label>
       <div class="field">
        <input id="newname" type="text" name="newname" class="large" maxlength="64">
       </div>
      </div>
      <div class="form-row">
       <label for="vpnserver_in"><script language=Javascript>document.write("Remote IPSec address")</script></label>
       <div class="field">
        <input id="vpnserver_in" type="text" name="vpnserver_in" class=" validate[required] large required" maxlength="128">
       </div>
      </div>
      <div class="form-row">
       <label for="remotelan"><script language=Javascript>document.write("Remote LAN address")</script></label>
       <script language="JavaScript">htmlGenIpBlocks("remote_lan");</script>
      </div>
      <div class="form-row">
       <label for="remotemask"><script language=Javascript>document.write("Remote LAN subnet mask")</script></label>
       <script language="JavaScript">htmlGenMaskBlocks("remote_mask");</script>
      </div>
      <div class="form-row">
       <label for="locallan"><script language=Javascript>document.write("Local LAN address")</script></label>
       <script language="JavaScript">htmlGenIpBlocks("local_lan");</script>
      </div>
      <div class="form-row">
       <label for="localmask"><script language=Javascript>document.write("Local LAN subnet mask")</script></label>
       <script language="JavaScript">htmlGenMaskBlocks("local_mask");</script>
      </div>
      <div class="form-row">
       <label for="ipsecEncap"><script language=Javascript>document.write("Encapsulation type")</script></label>
       <div class="field">
        <select name="ipsecEncap" id="ipsecEncap">
         <option value="any"><script>document.write("Any")</script></option>
         <option value="esp"><script>document.write("ESP")</script></option>
         <option value="ah"><script>document.write("AH")</script></option>
        </select>
       </div>
      </div>
      <div class="form-row">
       <label for="ipsec_ikemode"><script language=Javascript>document.write("IKE mode")</script></label>
       <div class="field">
        <select name="ipsec_ikemode" id="ipsec_ikemode">
         <option value="any"><script>document.write("Any")</script></option>
         <option value="main"><script>document.write("Main")</script></option>
         <option value="aggressive"><script>document.write("Aggressive")</script></option>
        </select>
       </div>
      </div>
      <div class="form-row">
       <label for="ipsec_pfs"><script language=Javascript>document.write("PFS")</script></label>
       <div class="field">
        <select name="ipsec_pfs" id="ipsec_pfs">
         <option value="on"><script>document.write("On")</script></option>
         <option value="off"><script>document.write("Off")</script></option>
        </select>
       </div>
      </div>
      <div class="form-row">
       <label for="ipsec_ikeenc"><script language=Javascript>document.write("IKE encryption")</script></label>
       <div class="field">
        <select name="ipsec_ikeenc" id="ipsec_ikeenc">
         <option value="any"><script>document.write("Any")</script></option>
         <option value="aes"><script>document.write("AES")</script></option>
         <option value="aes128"><script>document.write("AES-128")</script></option>
         <option value="aes192"><script>document.write("AES-192")</script></option>
         <option value="aes256"><script>document.write("AES-256")</script></option>
         <option value="3des"><script>document.write("3DES")</script></option>
         <option value="des"><script>document.write("DES")</script></option>
        </select>
       </div>
      </div>
      <div class="form-row">
       <label for="ipsec_ikehash"><script language=Javascript>document.write("IKE hash")</script></label>
       <div class="field">
        <select name="ipsec_ikehash" id="ipsec_ikehash">
         <option value="any"><script>document.write("Any")</script></option>
         <option value="md5"><script>document.write("MD5")</script></option>
         <option value="sha1"><script>document.write("SHA1")</script></option>
        </select>
       </div>
      </div>
      <div class="form-row">
       <label for="ipsec_enc"><script language=Javascript>document.write("IPSec encryption")</script></label>
       <div class="field">
        <select name="ipsec_enc" id="ipsec_enc">
         <option value="any"><script>document.write("Any")</script></option>
         <option value="aes"><script>document.write("AES")</script></option>
         <option value="aes128"><script>document.write("AES-128")</script></option>
         <option value="aes192"><script>document.write("AES-192")</script></option>
         <option value="aes256"><script>document.write("AES-256")</script></option>
         <option value="3des"><script>document.write("3DES")</script></option>
         <option value="des"><script>document.write("DES")</script></option>
        </select>
       </div>
      </div>
      <div class="form-row">
       <label for="ipsec_hash"><script language=Javascript>document.write("IPSec hash")</script></label>
       <div class="field">
        <select name="ipsec_hash" id="ipsec_hash">
         <option value="any"><script>document.write("Any")</script></option>
         <option value="md5"><script>document.write("MD5")</script></option>
         <option value="sha1"><script>document.write("SHA1")</script></option>
        </select>
       </div>
      </div>
      <div class="form-row">
       <label for="ipsec_dhg"><script language=Javascript>document.write("DH group")</script></label>
       <div class="field">
        <select name="ipsec_dhg" id="ipsec_dhg">
         <option value="any"><script>document.write("Any")</script></option>
         <option value="modp768"><script>document.write("Group1(768)")</script></option>
         <option value="modp1024"><script>document.write("Group2(1024)")</script></option>
         <option value="modp1536"><script>document.write("Group5(1536)")</script></option>
         <option value="modp2048"><script>document.write("Group14(2048)")</script></option>
         <option value="modp3072"><script>document.write("Group15(3072)")</script></option>
         <option value="modp4096"><script>document.write("Group16(4096)")</script></option>
         <option value="modp6144"><script>document.write("Group17(6144)")</script></option>
         <option value="modp8192"><script>document.write("Group18(8192)")</script></option>
        </select>
       </div>
      </div>
      <div class="form-row">
       <label for="ipsec_dpdaction"><script language=Javascript>document.write("DPD action")</script></label>
       <div class="field">
        <select name="ipsec_dpdaction" id="ipsec_dpdaction">
         <option value="none"><script>document.write("None")</script></option>
         <option value="clear"><script>document.write("Clear")</script></option>
         <option value="hold"><script>document.write("Hold")</script></option>
         <option value="restart"><script>document.write("Restart")</script></option>
        </select>
       </div>
      </div>
      <div class="form-row">
       <label for="DpdTimeDelay"><script language=Javascript>document.write("DPD keep alive time")</script></label>
       <div class="field">
        <input id="DpdTimeDelay" type="text" name="DpdTimeDelay" class="validate[required] sml required" maxlength=5 onkeyup=NumfieldEntry(this);>
        <span class="normal-text">&nbsp;<script language=Javascript>document.write("secs")</script></span>
       </div>
      </div>
      <div class="form-row">
       <label for="DpdTimeout"><script language=Javascript>document.write("DPD timeout")</script></label>
       <div class="field">
        <input id="DpdTimeout" type="text" name="DpdTimeout" class="validate[required] sml required" maxlength=5 onkeyup=NumfieldEntry(this);>
        <span class="normal-text">&nbsp;<script language=Javascript>document.write("secs")</script></span>
       </div>
      </div>
      <div class="form-row">
       <label for="IpsecIkeTime"><script language=Javascript>document.write("IKE re-key time")</script></label>
       <div class="field">
        <input id="IpsecIkeTime" type="text" name="IpsecIkeTime" class="validate[required,funcCall[validate_IpsecIkeTime] sml required IpsecIkeTime" maxlength=5 onkeyup=NumfieldEntry(this);>
        <span class="normal-text">&nbsp;<script language=Javascript>document.write("(0-78400, 0=Unlimited) secs")</script></span>
       </div>
      </div>
      <div class="form-row">
       <label for="IpsecLifeTime"><script language=Javascript>document.write("SA life time")</script></label>
       <div class="field">
        <input id="IpsecLifeTime" type="text" name="IpsecLifeTime" class="validate[required,funcCall[validate_IpsecLifeTime] sml required IpsecLifeTime" maxlength=5 onkeyup=NumfieldEntry(this);>
        <span class="normal-text">&nbsp;<script language=Javascript>document.write("(0-78400, 0=Unlimited) secs")</script></span>
       </div>
      </div>
      <div class="form-row">
       <label for="IpSecMethod"><script language=Javascript>document.write("Key mode")</script></label>
       <div class="field">
        <select name="IpSecMethod" id="IpSecMethod" onChange="setKeyMode()">
         <option value="psk"><script>document.write("Pre-shared keys")</script></option>
         <option value="rsa"><script>document.write("RSA keys")</script></option>
         <option value="cert"><script>document.write("Certificates")</script></option>
        </select>
       </div>
      </div>
      <div id="ipsecPresharedKeyDiv">
       <div class="form-row">
        <label for="PskValue"><script language=Javascript>document.write("Pre-shared key")</script></label>
        <div class="field">
         <input id="PskValue" type="text" name="PskValue" class="large required validate[required]">
        </div>
       </div>
       <div class="form-row">
        <label for="PskRemoteId"><script language=Javascript>document.write("Remote ID")</script></label>
        <div class="field">
         <input id="PskRemoteId" type="text" name="PskRemoteId" class="large" maxlength=64>
         <span class="normal-text">&nbsp;<script language=Javascript>document.write("(xy.sample.com or blank)")</script></span>
        </div>
       </div>
       <div class="form-row">
        <label for="PskLocalId"><script language=Javascript>document.write("Local ID")</script></label>
        <div class="field">
         <input id="PskLocalId" type="text" name="PskLocalId" class="large" maxlength=64>
         <span class="normal-text">&nbsp;<script language=Javascript>document.write("(xy.sample.com or blank)")</script></span>
        </div>
       </div>
      </div>
      <div id="ipsecRsaKeyDiv">
       <div class="form-row">
        <label for="RsaRemoteId"><script language=Javascript>document.write("Remote ID")</script></label>
        <div class="field">
         <input id="RsaRemoteId" type="text" name="RsaRemoteId" class="large" maxlength=64>
        </div>
        <div class="field-des"><script language=Javascript>document.write("(xy.sample.com or blank)")</script></div>
       </div>
       <div class="form-row">
        <label for="RsaLocalId"><script language=Javascript>document.write("Local ID")</script></label>
        <div class="field">
         <input id="RsaLocalId" type="text" name="RsaLocalId" class="large" maxlength=64>
        </div>
        <div class="field-des"><script language=Javascript>document.write("(xy.sample.com or blank)")</script></div>
       </div>
       <div class="form-row">
        <label for="ipsecRsaKeyTime"><script language=Javascript>document.write("Update time:")</script></label>
        <div class="field">
         <input type="text" id="ipsecRsaKeyTime" name="ipsecRsaKeyTime" size=30 maxlength=64 value="Sep 19 2011 14:18:00" class="certi_menu_item" readonly>
        </div>
       </div>
       <div class="submit-row">
        <button type="button" class="secondary minimum" id="ipsecSecretKeyGenBtn" onClick="ipsecSecretKeyGenBtnClick()"><script language=Javascript>document.write("Generate")</script></button>
        <button type="button" class="secondary minimum" id="ipsecDnRsaBtn" onClick="ipsecDnRsaBtnClick()"><script language=Javascript>document.write("Download")</script></button>
       </div>
      </div>
      <div id="ipsecFormCertDiv">
       <div class="form-row">
        <label for="KeyPassword"><script language=Javascript>document.write("Private key passphrase")</script></label>
        <div class="field">
         <input id="KeyPassword" type="text" class="required validate[required]" name="KeyPassword">
        </div>
       </div>
       <div class="form-row">
        <label for="uploadFileType"><script language=Javascript>document.write("Key / Certificate")</script></label>
        <div class="field">
         <select name="uploadFileType" id="uploadFileType" onClick="UpdateIpsecCertInfo()">
         <!--<option value="psk" onClick="javascript:document.form.IpSecMethod.value='psk'">Pre-shared Keys</option> -->
          <option value="key"><script>document.write("Local private key")</script></option>
          <option value="local"><script>document.write("Local public certificate")</script></option>
          <option value="remote"><script>document.write("Remote public certificate")</script></option>
          <option value="ca"><script>document.write("CA certificate")</script></option>
          <option value="crls"><script>document.write("CRL certificate")</script></option>
         </select>
        </div>
        <div class="field-des" id=certUploadMsg><script language=Javascript>document.write("Not uploaded")</script></div>
       </div>
      </div>
     </div>
    </div>
   </div>
   </form>
   <div id="editDiv1" class="grey-box" style="display:none; margin:-12px 10px;">
    <div style="margin-left:-14px">
     <div id="ipsecLocalRsaDiv" id="box_2144_pin">
      <form id="formIpsecLocalRsaUp" name="formIpsecLocalRsaUp" class="content" method="POST" action="/cgi-bin/ipsec_action.cgi?action=upload" encType="multipart/form-data">
       <input type="hidden" id="ipsecLocalRsaUpSubaction" name="subaction" value="upIpsecLocalRsa"/>
       <input type="hidden" id="ipsecLocalRsaUpParam" name="param" value=""/>
       <div class="form-row" style="padding-top:30px;">
        <label for="upIpsecLocalRsaFile"><script language=Javascript>document.write("Local RSA key upload")</script></label>
        <div class="field">
         <span class="file-wrapper">
          <input type="file" id="ipsecLocalRsaUpFile" name="ipsecLocalRsaUpFile" onchange="ipsecLocalRsaUpFileChange()">
          <span class="secondary button"><script language=Javascript>document.write("Choose a file")</script></span>
         </span>
        </div>
       </div>
       <button type="button" class="secondary file-upload" id="ipsecLocalRsaUpBtn" onClick="ipsecUploadTargetStart(formIpsecLocalRsaUp)" disabled=true><script language=Javascript>document.write("Upload")</script></button>
      </form>
     </div>
     <div id="ipsecRemoteRsaDiv" id="box_2144_pin">
      <form id="formIpsecRsaUp" name="formIpsecRsaUp" class="content" method="POST" action="/cgi-bin/ipsec_action.cgi?action=upload" encType="multipart/form-data">
       <input type="hidden" id="ipsecRsaUpSubaction" name="subaction" value="upIpsecRsa"/>
       <input type="hidden" id="ipsecRsaUpParam" name="param" value=""/>
       <div class="form-row">
        <label for="ipsecRsaUpFile"><script language=Javascript>document.write("Remote RSA key upload")</script></label>
        <div class="field">
         <span class="file-wrapper">
          <input type="file" id="ipsecRsaUpFile" name="ipsecRsaUpFile" onchange="ipsecRsaUpFileChange()">
          <span class="secondary button"><script language=Javascript>document.write("Choose a file")</script></span>
         </span>
        </div>
       </div>
       <button type="button" class="secondary file-upload" id="ipsecRsaUpBtn" onClick="ipsecUploadTargetStart(formIpsecRsaUp)" disabled=true><script language=Javascript>document.write("Upload")</script></button>
      </form>
     </div>
     <div id="ipsecCertsDiv" id="box_2144_pin">
      <form id="formIpsecCertiUp" name="formIpsecCertiUp" class="content" method="POST" action="/cgi-bin/ipsec_action.cgi?action=upload" encType="multipart/form-data">
       <input type="hidden" id="ipsecCertiUpSubaction" name="subaction" value="upIpsecCert"/>
       <input type="hidden" id="ipsecCertiUpParam" name="param" value=""/>
       <div class="form-row" style="padding-top:30px;">
        <label for="ipsecRsaUpFile"><script language=Javascript>document.write("IPSec certificate upload")</script></label>
        <div class="field">
         <span class="file-wrapper">
          <input type="file" id="ipsecCertiUpFile" name="ipsecCertiUpFile" onchange="ipsecCertiUpFileChange()">
          <span class="secondary button"><script language=Javascript>document.write("Choose a file")</script></span>
         </span>
        </div>
       </div>
       <button type="button" class="secondary file-upload" id="ipsecCertiUpBtn" onClick="ipsecUploadTargetStart(formIpsecCertiUp)" disabled=true><script language=Javascript>document.write("Upload")</script></button>
      </form>
     </div>
    </div>
   </div>
   <!--- hidden download form for IPSEC--->
   <form id="formIpsecActionDn" name="formIpsecActionDn" method="GET" action="/cgi-bin/ipsec_action.cgi" encType="multipart/form-data" style='display:none'>
    <input type="hidden" id="ipsec_dn_action" name="action" value=""/>
    <input type="hidden" id="ipsec_dn_param" name="param" value=""/>
   </form>
   <!--- hidden iframe for upload --->
   <iframe id="uploadTarget" name="uploadTarget" src="" style="width:0;height:0;border:0px solid #fff;" onload=" javascript:ipsecUploadTargetOnLoad()"></iframe>
   <div id="saveDiv" class="submit-row" style="padding-left:12px;display:none">
    <button type="button" name="saveButton" id="submitBtn" type="submit" onClick="javascript:exitHandler()"><script language=Javascript>document.write("Save")</script></button>
    <button type="button" class="secondary" name="exitButton" id="exitBtn" type="submit" onClick="javascript:exitHandler()"><script language=Javascript>document.write("Exit")</script></button>
   </div>
  </div>
 </div>
</div>
</div>
<footer class="footer">
 <div class="container">
  <p class="copy-right"><script language=Javascript>document.write("Powered by Mongoose Advanced Technologies")</script></p>
 </div>
</footer>
<script language='javascript'>
        set_menu("Internet", "IP_Sec", "root");
/********* vdf validator**********/
 VALIDATOR.config.errors["IpsecIkeTime"]="IKE re-key time must have a value between 0 and 78400.";
 $.validator.addMethod("IpsecIkeTime",function(c,a) {
  if(c!==$(a).attr("data-watermark")) {
   if( c < 0 || c > 78400 ) {
    return false;
   }
  }
  else if($(a).hasClass("required")) {
   return false;
  }
  return true;
 },VALIDATOR.config.errors.IpsecIkeTime);
 VALIDATOR.config.errors["IpsecLifeTime"]="SA life time must have a value between 0 and 78400.";
 $.validator.addMethod("IpsecLifeTime",function(c,a) {
  if(c!==$(a).attr("data-watermark")) {
   if( c < 0 || c > 78400 ) {
    return false;
   }
  }
  else if($(a).hasClass("required")) {
   return false;
  }
  return true;
 },VALIDATOR.config.errors.IpsecLifeTime);
 if(""=="success") {
  success_alert("","Your IPSec VPN configuration changes were successfully saved and applied");
 }
</script>
</body>
</html>
